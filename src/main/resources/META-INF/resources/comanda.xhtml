<!DOCTYPE html>
<html lang="pt-br"
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:p="http://primefaces.org/ui"
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
    xmlns:f="http://xmlns.jcp.org/jsp/jstl/core">

<h:head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Comanda</title>
    <style>
        body {
            font-family: sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f0f0f0;
        }

        .container {
            width: 90%;
            margin: 0 auto;
            background-color: white;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            padding: 20px;
        }

        .header {
            background-color: #d9534f; /* Vermelho */
            color: white;
            padding: 10px 0;
            text-align: center;
            border-radius: 5px 5px 0 0;
        }

        .header h1 {
            margin: 0;
        }

        .content {
            display: flex;
            margin-top: 20px;
        }

        .left-side {
            width: 50%;
            padding: 10px;
            border-right: 1px solid #ddd;
        }

        .right-side {
            width: 50%;
            padding: 10px;
        }

        .container-button {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }

        .container-button button {
            background-color: #f4f4f4;
            border: none;
            color: black;
            padding: 15px 32px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin: 4px 2px;
            border-radius: 4px;
            cursor: pointer;
        }

        .container-button button:hover {
            background-color: #ddd;
        }

        .exclude-item-button {
            padding: 8px 15px;
            background-color: #d9534f; /* Vermelho */
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .exclude-item-button:hover {
            background-color: #c9302c;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th, td {
            padding: 8px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        th {
            background-color: #f0f0f0;
        }

        .total {
            text-align: center;
            font-size: 24px;
            font-weight: bold;
            margin-top: 20px;
        }
    </style>
</h:head>

<h:body style="background-color: #DDAC7E;">
    <ui:include src="includes/navbar.xhtml" />
    <div class="container">
        <div class="header">
            <h1>COMANDA: Mesa #{mesaControl.mesa.numero}</h1>
        </div>

        <div class="content">
            <div class="left-side">
                <h2>Cardápio Rápido</h2>
                <div class="container-button">
                    <p:commandButton type="button" value="Refrigerante Lata Coca" onclick="adicionarItem(1)" styleClass="item-button" />
                    <p:commandButton type="button" value="Hamburguer" onclick="adicionarItem(2)" styleClass="item-button" />
                    <p:commandButton type="button" value="Refrigerante 600ml Fanta Uva" onclick="adicionarItem(3)" styleClass="item-button" />
                    <p:commandButton type="button" value="Porção Batata com Bacon Grande" onclick="adicionarItem(4)" styleClass="item-button" />
                    <p:commandButton type="button" value="Cachorro Quente Super" onclick="adicionarItem(5)" styleClass="item-button" />
                    <p:commandButton type="button" value="Americano" onclick="adicionarItem(6)" styleClass="item-button" />
                    <p:commandButton type="button" value="X Salada" onclick="adicionarItem(7)" styleClass="item-button" />
                    <p:commandButton type="button" value="Refrigerante 600ml Coca" onclick="adicionarItem(8)" styleClass="item-button" />
                    <p:commandButton type="button" value="X Tudo" onclick="adicionarItem(9)" styleClass="item-button" />
                    <p:commandButton type="button" value="X Burguer" onclick="adicionarItem(10)" styleClass="item-button" />
                    <p:commandButton type="button" value="X Bacon" onclick="adicionarItem(11)" styleClass="item-button" />
                    <p:commandButton type="button" value="Refrigerante 1 Litro Sprite" onclick="adicionarItem(12)" styleClass="item-button" />
                </div>
            </div>

            <div class="right-side">
                <h:form id="formComanda">
                    <h:panelGrid columns="3">
                        <h:outputLabel for="cliente" value="Consumidor Padrão:" />
                        <p:inputText id="cliente" value="Consumidor Padrão" readonly="true" />
                        <p:commandButton value="Buscar" styleClass="search-button"/>
                        <h:outputLabel for="descricao" value="Descrição do item:" />
                        <p:inputText id="descricao" value="#{comandaBean.itemSelecionado.descricao}" readonly="true" />
                        <p:commandButton value="Buscar" styleClass="search-button"/>
                    </h:panelGrid>
                    <h:panelGrid columns="2">
                        <h:outputLabel for="codigo" value="Código:" />
                        <p:inputText id="codigo" value="" readonly="true" />
                        <h:outputLabel for="quantidade" value="Quantidade:" />
                        <p:inputNumber id="quantidade" value="#{comandaBean.itemSelecionado.quantidade}" readonly="true" />
                        <h:outputLabel for="precoUnitario" value="Preço Unitário:" />
                        <p:inputNumber id="precoUnitario" value="#{comandaBean.itemSelecionado.precoUnitario}" readonly="true" />
                    </h:panelGrid>
                    
                    <h:panelGrid columns="2">
                        <h:outputLabel value="Selecionar Item do Cardápio:" />
                        <p:selectOneMenu value="#{comandaBean.selectedItemCardapio}">
                            <selectItem itemLabel="Selecione um item" itemValue="" />
                            <selectItems value="#{comandaBean.itensCardapio}" var="itemCardapio" itemLabel="#{itemCardapio.descricao}" itemValue="#{itemCardapio}" />
                        </p:selectOneMenu>

                        <p:commandButton value="Adicionar Item" action="#{comandaBean.adicionarItemComanda}" update="itensComanda, total"></p:commandButton>
                    </h:panelGrid>

                    <h:panelGroup id="itensComanda">
                        <h:dataTable value="#{comandaBean.itensComanda}" var="item">
                            <h:column>
                                <facet name="header">Descrição</facet>
                                <h:outputText value="#{item.descricao}" />
                            </h:column>
                            <h:column>
                                <facet name="header">Quantidade</facet>
                                <h:outputText value="#{item.quantidade}" />
                            </h:column>
                            <h:column>
                                <facet name="header">Subtotal</facet>
                                <h:outputText value="#{item.subtotal}" />
                            </h:column>
                            <h:column>
                                <facet name="header">Ações</facet>
                                <p:commandButton value="Excluir" action="#{comandaBean.excluirItem(item)}" update="itensComanda, total"></p:commandButton>
                            </h:column>
                        </h:dataTable>
                    </h:panelGroup>

                    <h:panelGroup id="total">
                        <h:outputText value="Total: #{comandaBean.total}" />
                    </h:panelGroup>
                </h:form>
            </div>
        </div>
    </div>

    <script>
        function adicionarItem(itemId) {
            var descricao;
            var precoUnitario;

            switch (itemId) {
                case 1:
                    descricao = "Refrigerante Lata Coca";
                    precoUnitario = 5.0;
                    break;
                case 2:
                    descricao = "Hamburguer";
                    precoUnitario = 15.0;
                    break;
                case 3:
                    descricao = "Refrigerante 600ml Fanta Uva";
                    precoUnitario = 8.0;
                    break;
                case 4:
                    descricao = "Porção Batata com Bacon Grande";
                    precoUnitario = 20.0;
                    break;
                case 5:
                    descricao = "Cachorro Quente Super";
                    precoUnitario = 10.0;
                    break;
                case 6:
                    descricao = "Americano";
                    precoUnitario = 12.0;
                    break;
                case 7:
                    descricao = "X Salada";
                    precoUnitario = 18.0;
                    break;
                case 8:
                    descricao = "Refrigerante 600ml Coca";
                    precoUnitario = 8.0;
                    break;
                case 9:
                    descricao = "X Tudo";
                    precoUnitario = 22.0;
                    break;
                case 10:
                    descricao = "X Burguer";
                    precoUnitario = 16.0;
                    break;
                case 11:
                    descricao = "X Bacon";
                    precoUnitario = 17.0;
                    break;
                case 12:
                    descricao = "Refrigerante 1 Litro Sprite";
                    precoUnitario = 10.0;
                    break;
                default:
                    descricao = "";
                    precoUnitario = 0.0;
                    break;
            }

            // Monta o objeto de item selecionado
            var itemSelecionado = {
                descricao: descricao,
                precoUnitario: precoUnitario,
                quantidade: 1,
                subtotal: precoUnitario
            };

            // Atualiza os campos do formulário com os valores do item selecionado
            document.getElementById('formComanda:descricao').value = itemSelecionado.descricao;
            document.getElementById('formComanda:quantidade').value = itemSelecionado.quantidade;
            document.getElementById('formComanda:precoUnitario').value = itemSelecionado.precoUnitario.toFixed(2);

            // Atualiza a lista de itens do pedido (tabela)
            var table = document.getElementById('itensComanda');
            var row = table.insertRow();
            var cell1 = row.insertCell(0);
            var cell2 = row.insertCell(1);
            var cell3 = row.insertCell(2);
            var cell4 = row.insertCell(3);
            var cell5 = row.insertCell(4);

            cell1.innerHTML = itemSelecionado.descricao;
            cell2.innerHTML = itemSelecionado.precoUnitario.toFixed(2);
            cell3.innerHTML = itemSelecionado.quantidade;
            cell4.innerHTML = itemSelecionado.subtotal.toFixed(2);
            cell5.innerHTML = '<p:commandButton value="Excluir" actionListener="#{comandaBean.excluirItem(item)}" update="itensComanda, total" styleClass="exclude-item-button"/>';

            // Calcula e atualiza o total
            var total = document.getElementById('total');
            var totalValue = parseFloat(total.innerHTML.replace('Total: ', '').trim());
            totalValue += itemSelecionado.subtotal;
            total.innerHTML = 'Total: ' + totalValue.toFixed(2);

            // Chama o p:remoteCommand para adicionar o item na comanda no backend
            adicionarItemComanda([{name: 'descricao', value: itemSelecionado.descricao}, {name: 'quantidade', value: itemSelecionado.quantidade}, {name: 'precoUnitario', value: itemSelecionado.precoUnitario}]);
        }

        function excluirItem(button) {
            var row = button.parentNode.parentNode;
            var subtotal = parseFloat(row.cells[3].innerHTML);
            var total = document.getElementById('total');
            var totalValue = parseFloat(total.innerHTML.replace('Total: ', '').trim());
            totalValue -= subtotal;
            total.innerHTML = 'Total: ' + totalValue.toFixed(2);
            row.parentNode.removeChild(row);
        }
    </script>
</h:body>
</html>
