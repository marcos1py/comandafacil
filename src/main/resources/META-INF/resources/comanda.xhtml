<!DOCTYPE html>
<html lang="pt-br" xmlns="http://www.w3.org/1999/xhtml" xmlns:p="http://primefaces.org/ui"
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets" xmlns:f="http://xmlns.jcp.org/jsf/core"
    xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns:c="http://java.sun.com/jsp/jstl/core"
    xmlns:spring="http://www.springframework.org/schema/beans">
<h:head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Comanda</title>
    <style>
        body {
            font-family: sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f0f0f0;
        }

        .container {
            width: 90%;
            margin: 0 auto;
            background-color: white;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            padding: 20px;
        }

        .header {
            background-color: #d9534f;
            /* Vermelho */
            color: white;
            padding: 10px 0;
            text-align: center;
            border-radius: 5px 5px 0 0;
        }

        .header h1 {
            margin: 0;
        }

        .content {
            display: flex;
            margin-top: 20px;
        }

        .left-side {
            width: 50%;
            padding: 10px;
            border-right: 1px solid #ddd;
        }

        .right-side {
            width: 50%;
            padding: 10px;
        }

        .container-button {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }

        .container-button button {
            background-color: #f4f4f4;
            border: none;
            color: black;
            padding: 15px 32px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin: 4px 2px;
            border-radius: 4px;
            cursor: pointer;
        }

        .container-button button:hover {
            background-color: #ddd;
        }

        .exclude-item-button {
            padding: 8px 15px;
            background-color: #d9534f;
            /* Vermelho */
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .exclude-item-button:hover {
            background-color: #c9302c;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th,
        td {
            padding: 8px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        th {
            background-color: #f0f0f0;
        }

        .total {
            text-align: center;
            font-size: 24px;
            font-weight: bold;
            margin-top: 20px;
        }
        .product-scroller {
    width: 50%;
}
 
.product-item {
    display: flex;
    border: 1px solid #ccc;
    margin-bottom: 20px;
}

.product-image {
    width: 200px;
    height: auto;
    margin-right: 20px;
}

.product-details {
    flex-grow: 1;
    padding: 10px;
}

.product-name {
    font-weight: bold;
    font-size: 1.2em;
    margin-bottom: 5px;
}

.product-description {
    margin-bottom: 10px;
}

.product-price {
    font-size: 1.2em;
}

.product-action {
    margin-top: 10px;
}

.product-button {
    width: 150px;
}


    </style>
</h:head>

<h:body style="background-color: #DDAC7E;">
    <ui:include src="includes/navbar.xhtml" />
    <div class="container">
        <div class="header">
            <h1>COMANDA: Mesa #{mesaControl.mesa.numero}</h1>
        </div>

        <div class="">
            <div class="left-side">
                <h2>Cardápio Rápido</h2>
            </div>
                <div>
                    <h:form>
                        <p:inputText id="searchInput" value="#{comandaControl.searchKeyword}" placeholder="Digite sua busca" />
                        <p:commandButton value="Buscar" action="#{comandaControl.search}" update="productScroller" />
                    
                        <p:dataScroller id="productScroller" value="#{comandaControl.filteredItensCardapio}" var="item" chunkSize="10" styleClass="product-scroller" mode="inline" scrollHeight="450">
                            <f:facet name="name">Itens do Cardápio</f:facet> 
                    
                            <div class="product-item">
                                <p:graphicImage name="img/comida.jpg" styleClass="product-image" />
                                <div class="product-details">
                                    <div class="product-name">#{item.nome}</div>
                                    <div class="product-description">#{item.descricao}</div>
                                    <div class="product-price">
                                        <h:outputText value="#{item.precoUnitario}" styleClass="product-price">
                                            <f:convertNumber currencySymbol="$" type="currency" />
                                        </h:outputText>
                                    </div>
                                    <div class="product-action">
                                        <p:commandButton value="Add To Cart" icon="pi pi-shopping-cart" styleClass="product-button"/>
                                    </div>
                                </div>
                            </div>
                        </p:dataScroller>
                    </h:form>
                    
                </div>
                
            <div class="right-side">
                <h2>Cliente</h2>
                <div class="form-group">
                    <h:outputLabel for="cliente" value="Consumidor Padrão:" />
                    <p:inputText id="cliente" value="Consumidor Padrão" readonly="true" />
                </div>
                <div class="form-group">
                    <p:commandButton value="Buscar" styleClass="search-button"/>
                </div>
                <div class="form-group">
                    <h:outputLabel for="codigo" value="Código:" />
                    <p:inputText id="codigo" value="" readonly="true" />
                </div>
                <div class="form-group">
                    <div class="form-group">
                        <h:outputLabel for="descricao" value="Descrição do item:" />
                        <p:inputText id="descricao" value="#{comandaBean.itemSelecionado.descricao}" readonly="true" />
                    </div>
                    <div class="form-group">
                        <p:commandButton value="Buscar" styleClass="search-button"/>
                    </div>
                    <div class="form-group">
                        <h:outputLabel for="quantidade" value="Quantidade:" />
                        <p:inputNumber id="quantidade" value="#{comandaBean.itemSelecionado.quantidade}" readonly="true" />
                    </div>
                    <div class="form-group">
                        <h:outputLabel for="precoUnitario" value="Preço Unitário:" />
                        <p:inputNumber id="precoUnitario" value="#{comandaBean.itemSelecionado.precoUnitario}" readonly="true" />
                    </div>
                </div>

                <h:form>
                    <div class="items-container">
                        <div class="item" id="itensComanda">
                            <ui:repeat value="#{comandaBean.itensComanda}" var="item" varStatus="status">
                                <div class="item-row">
                                    <div class="item-descricao">
                                        <h:outputText value="#{item.descricao}" />
                                    </div>
                                    <div class="item-quantidade">
                                        <h:outputText value="#{item.quantidade}" />
                                    </div>
                                    <div class="item-subtotal">
                                        <h:outputText value="#{item.subtotal}" />
                                    </div>
                                    <div class="item-excluir">
                                        <p:commandButton value="Excluir" actionListener="#{comandaBean.excluirItem(item)}" update="itensComanda, total" styleClass="exclude-item-button"/>
                                    </div>
                                </div>
                            </ui:repeat>
                        </div>
                    </div>

                    <p:outputPanel id="total" styleClass="total">
                        <h:outputText value="Total: #{comandaBean.total}" />
                    </p:outputPanel>

                    <div class="button-group">
                        <p:commandButton value="Sair da Comanda" />
                        <p:commandButton value="Imprimir Preparo" />
                        <p:commandButton value="Finalizar Venda" />
                        <p:commandButton value="Cancelar Mesa" />
                    </div>

                    <p:remoteCommand name="adicionarItemComanda" action="#{comandaBean.adicionarItemComanda}" update="itensComanda, total" />
                </h:form>
            </div>
        </div>
    </div>

    <script>
        function adicionarItem(itemId) {
            var descricao;
            var precoUnitario;

            switch (itemId) {
                case 1:
                    descricao = "Refrigerante Lata Coca";
                    precoUnitario = 5.0;
                    break;
                case 2:
                    descricao = "Hamburguer";
                    precoUnitario = 15.0;
                    break;
                case 3:
                    descricao = "Refrigerante 600ml Fanta Uva";
                    precoUnitario = 8.0;
                    break;
                case 4:
                    descricao = "Porção Batata com Bacon Grande";
                    precoUnitario = 20.0;
                    break;
                case 5:
                    descricao = "Cachorro Quente Super";
                    precoUnitario = 10.0;
                    break;
                case 6:
                    descricao = "Americano";
                    precoUnitario = 12.0;
                    break;
                case 7:
                    descricao = "X Salada";
                    precoUnitario = 18.0;
                    break;
                case 8:
                    descricao = "Refrigerante 600ml Coca";
                    precoUnitario = 8.0;
                    break;
                case 9:
                    descricao = "X Tudo";
                    precoUnitario = 22.0;
                    break;
                case 10:
                    descricao = "X Burguer";
                    precoUnitario = 16.0;
                    break;
                case 11:
                    descricao = "X Bacon";
                    precoUnitario = 17.0;
                    break;
                case 12:
                    descricao = "Refrigerante 1 Litro Sprite";
                    precoUnitario = 10.0;
                    break;
                default:
                    descricao = "";
                    precoUnitario = 0.0;
                    break;
            }

            // Monta o objeto de item selecionado
            var itemSelecionado = {
                descricao: descricao,
                precoUnitario: precoUnitario,
                quantidade: 1,
                subtotal: precoUnitario
            };

            // Atualiza os campos do formulário com os valores do item selecionado
            document.getElementById('formComanda:descricao').value = itemSelecionado.descricao;
            document.getElementById('formComanda:quantidade').value = itemSelecionado.quantidade;
            document.getElementById('formComanda:precoUnitario').value = itemSelecionado.precoUnitario.toFixed(2);

            // Atualiza a lista de itens do pedido (tabela)
            var table = document.getElementById('itensComanda');
            var row = table.insertRow();
            var cell1 = row.insertCell(0);
            var cell2 = row.insertCell(1);
            var cell3 = row.insertCell(2);
            var cell4 = row.insertCell(3);
            var cell5 = row.insertCell(4);

            cell1.innerHTML = itemSelecionado.descricao;
            cell2.innerHTML = itemSelecionado.precoUnitario.toFixed(2);
            cell3.innerHTML = itemSelecionado.quantidade;
            cell4.innerHTML = itemSelecionado.subtotal.toFixed(2);
            cell5.innerHTML = '<p:commandButton value="Excluir" actionListener="#{comandaBean.excluirItem(item)}" update="itensComanda, total" styleClass="exclude-item-button"/>';

            // Calcula e atualiza o total
            var total = document.getElementById('total');
            var totalValue = parseFloat(total.innerHTML.replace('Total: ', '').trim());
            totalValue += itemSelecionado.subtotal;
            total.innerHTML = 'Total: ' + totalValue.toFixed(2);

            // Chama o p:remoteCommand para adicionar o item na comanda no backend
            adicionarItemComanda([{ name: 'descricao', value: itemSelecionado.descricao }, { name: 'quantidade', value: itemSelecionado.quantidade }, { name: 'precoUnitario', value: itemSelecionado.precoUnitario }]);
        }

        function excluirItem(button) {
            var row = button.parentNode.parentNode;
            var subtotal = parseFloat(row.cells[3].innerHTML);
            var total = document.getElementById('total');
            var totalValue = parseFloat(total.innerHTML.replace('Total: ', '').trim());
            totalValue -= subtotal;
            total.innerHTML = 'Total: ' + totalValue.toFixed(2);
            row.parentNode.removeChild(row);
        }
    </script>
</h:body>

</html>